<div class="receipt-overlay" (click)="onClose()">
  <div class="receipt-modal" (click)="$event.stopPropagation()">

    <div class="receipt-paper">
      <!-- Header -->
      <div class="receipt-header">
        <div class="receipt-brand">
          <span class="brand-icon">✦</span>
          <span class="brand-name">VELOUR Studio</span>
        </div>
        <div class="receipt-meta">
          <span class="receipt-type">BOLETA DE VENTA ELECTRÓNICA</span>
          <span class="receipt-num">{{ receiptNumber }}</span>
        </div>
      </div>

      <div class="receipt-divider-deco">
        <span></span><span class="deco-diamond">◆</span><span></span>
      </div>

      <!-- Customer Info -->
      <div class="receipt-customer">
        <div class="info-row">
          <span class="info-label">Cliente</span>
          <span class="info-value">{{ customer }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">DNI/RUC</span>
          <span class="info-value">{{ ruc }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Fecha</span>
          <span class="info-value">{{ date | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </div>

      <div class="receipt-rule"></div>

      <!-- Items -->
      <table class="receipt-table">
        <thead>
          <tr>
            <th class="col-desc">Descripción</th>
            <th class="col-qty">Cant.</th>
            <th class="col-unit">P. Unit.</th>
            <th class="col-total">Total</th>
          </tr>
        </thead>
        <tbody>
          @for (item of items(); track item.product.id) {
            <tr>
              <td class="col-desc">
                <span class="item-emoji-sm">{{ item.product.emoji }}</span>
                {{ item.product.name }}
              </td>
              <td class="col-qty">{{ item.quantity }}</td>
              <td class="col-unit">S/ {{ item.product.price | number:'1.2-2' }}</td>
              <td class="col-total">S/ {{ (item.product.price * item.quantity) | number:'1.2-2' }}</td>
            </tr>
          }
        </tbody>
      </table>

      <div class="receipt-rule"></div>

      <!-- Totals -->
      <div class="receipt-totals">
        <div class="total-row">
          <span>OP. GRAVADA</span>
          <span>S/ {{ subtotal() | number:'1.2-2' }}</span>
        </div>
        <div class="total-row">
          <span>IGV (18%)</span>
          <span>S/ {{ igv() | number:'1.2-2' }}</span>
        </div>
        <div class="total-final">
          <span>IMPORTE TOTAL</span>
          <span>S/ {{ total() | number:'1.2-2' }}</span>
        </div>
      </div>

      <div class="receipt-divider-deco">
        <span></span><span class="deco-diamond">◆</span><span></span>
      </div>

      <div class="receipt-footer">
        <p>Gracias por tu compra en VELOUR Studio</p>
        <p class="footer-sub">Representación impresa de la Boleta Electrónica</p>
        <div class="barcode">
          <div class="barcode-bars">
            @for (bar of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]; track $index) {
              <div class="bar" [style.height]="($index % 3 === 0 ? 28 : 20) + 'px'"></div>
            }
          </div>
          <span class="barcode-text">{{ receiptNumber }}</span>
        </div>
      </div>
    </div>

    <button class="btn-close-receipt" (click)="onClose()">
      Cerrar y Finalizar compra
    </button>
  </div>
</div>
